<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Policía y Ladrón</title>
</head>
<body>
  <button id="btnPolicia">Soy Policía</button>
  <button id="btnLadron">Soy Ladrón</button>
  <div id="vista"></div>
  <video id="camara" autoplay playsinline style="display:none;"></video>
  <audio id="alertSound" src="alerta.mp3" preload="auto"></audio>

<script>
  const ws = new WebSocket("ws://TU_SERVIDOR:8080");
  const vista = document.getElementById('vista');
  const camara = document.getElementById('camara');
  const alertSound = document.getElementById('alertSound');

  let role = null;

  document.getElementById('btnPolicia').onclick = () => {
    role = "policia";
    vista.textContent = "Se activará la alarma cuando el ladrón escape...";
  };

  document.getElementById('btnLadron').onclick = () => {
    role = "ladron";
    vista.innerHTML = "<button id='escapar'>Escapar</button>";
    document.getElementById('escapar').onclick = () => {
      ws.send(JSON.stringify({ type: "ESCAPE" }));
      vista.textContent = "¡Escapaste! Activando cámara en 2 segundos...";
      setTimeout(async () => {
        camara.style.display = "block";
        try {
          const stream = await navigator.mediaDevices.getUserMedia({ video: true });
          camara.srcObject = stream;
        } catch(e) {
          vista.textContent = "No se pudo activar la cámara.";
        }
      }, 2000);
    };
  };

  ws.onmessage = (event) => {
    const msg = JSON.parse(event.data);
    if (msg.type === "ESCAPE" && role === "policia") {
      vista.textContent = "¡El ladrón está escapando!";
      alertSound.play().catch(()=>{});
    }
  };
</script>
</body>
</html>
